<%
  mobile = local_assigns[:mobile] || false

  nav_items = [
    { path: main_app.root_path, icon: "squares-2x2", label: "Dashboard", active: controller_name == "home" }
  ]

  if current_organization
    nav_items += [
      { path: organizations.organizations_path, icon: "building-office-2", label: "Organizations", active: controller_name == "organizations" },
      { path: organizations.memberships_path, icon: "users", label: "Members", active: controller_name == "memberships" },
      { path: organizations.organization_invitations_path, icon: "envelope", label: "Invitations", active: controller_name == "invitations" }
    ]
  end
%>

<div class="flex grow flex-col gap-y-5 overflow-y-auto bg-white border-r border-gray-200 px-6 pb-4 h-full">
  <div class="flex h-16 shrink-0 items-center justify-between">
    <%= link_to main_app.root_path, class: "flex items-center gap-2 text-decoration-none" do %>
      <span class="text-2xl">üè¢</span>
      <span class="text-lg font-bold text-gray-900">organizations</span>
    <% end %>

    <% if mobile %>
      <button type="button" class="-m-2.5 p-2.5 text-gray-400 hover:text-gray-600" data-action="mobile-menu#close">
        <span class="sr-only">Close sidebar</span>
        <%= heroicon "x-mark", variant: :outline, options: { class: "h-6 w-6" } %>
      </button>
    <% end %>
  </div>

  <p class="text-xs text-gray-500 -mt-3">
    A Rails gem for multi-tenant organizations with memberships, roles & invitations. This is an interactive demo.
  </p>

  <%= link_to "https://github.com/rameerez/organizations",
    target: "_blank",
    rel: "noopener",
    class: "flex items-center justify-center gap-2 rounded-lg bg-gray-900 px-3 py-2 text-sm font-semibold text-white hover:bg-gray-700 transition-colors mb-4" do %>
    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
    </svg>
    <span><pre>rameerez/organizations</pre></span>
  <% end %>

  <nav class="flex flex-1 flex-col">
    <ul role="list" class="flex flex-1 flex-col gap-y-7">
      <%# Main navigation %>
      <li>
        <ul role="list" class="-mx-2 space-y-1">
          <% nav_items.each do |item| %>
            <li>
              <%= link_to item[:path],
                class: "group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 #{ item[:active] ? 'bg-gray-50 text-slate-600' : 'text-gray-700 hover:text-slate-600 hover:bg-gray-50' }",
                data: mobile ? { action: "click->mobile-menu#close" } : {} do %>
                <%= heroicon item[:icon], variant: :outline, options: { class: "h-6 w-6 shrink-0 #{ item[:active] ? 'text-slate-600' : 'text-gray-400 group-hover:text-slate-600' }" } %>
                <%= item[:label] %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </li>

      <%# Organization switcher %>
      <% if current_user && current_user.organizations.count > 1 %>
        <li>
          <div class="text-xs font-semibold leading-6 text-gray-400 mb-2">Switch Organization</div>
          <ul role="list" class="-mx-2 space-y-1">
            <% current_user.organizations.each do |org| %>
              <li>
                <% is_current = current_organization && org.id == current_organization.id %>
                <%= button_to organizations.switch_organization_path(org),
                  method: :post,
                  data: { turbo: false },
                  class: "w-full group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 #{ is_current ? 'bg-slate-100 text-slate-700' : 'text-gray-700 hover:text-slate-600 hover:bg-gray-50' }" do %>
                  <%= heroicon "building-office", variant: is_current ? :solid : :outline, options: { class: "h-5 w-5 shrink-0 #{ is_current ? 'text-slate-600' : 'text-gray-400 group-hover:text-slate-600' }" } %>
                  <span class="truncate"><%= org.name %></span>
                  <% if is_current %>
                    <span class="ml-auto text-xs text-slate-500">Current</span>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          </ul>
        </li>
      <% end %>

      <%# Demo tools section %>
      <li>
        <div class="text-xs font-semibold leading-6 text-gray-400 mb-2">Demo Tools</div>
        <ul role="list" class="-mx-2 space-y-1">
          <li>
            <%= link_to main_app.reset_demo_path,
              class: "group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-red-600 hover:bg-red-50",
              data: { turbo_confirm: "Reset all demo data? This will delete all users and organizations." } do %>
              <%= heroicon "arrow-path", variant: :outline, options: { class: "h-6 w-6 shrink-0 text-red-500" } %>
              Reset Demo
            <% end %>
          </li>
        </ul>
      </li>

      <%# RailsFast promo %>
      <li class="mt-auto">
        <%= link_to "https://railsfast.com?ref=organizations-demo",
          target: "_blank",
          rel: "noopener",
          class: "block rounded-xl bg-gray-900 p-4 hover:bg-gray-800 transition-colors shadow-lg" do %>
          <div class="flex items-center gap-2 mb-2">
            <span class="text-lg">üöÄ</span>
            <span class="text-base font-bold text-white">RailsFast</span>
          </div>
          <p class="text-sm text-gray-300 leading-relaxed">
            Don't want to wire all this? Get a SaaS boilerplate with organizations, auth, billing & much more ‚Äî ready out of the box.
          </p>
          <div class="mt-3 text-xs font-semibold text-gray-400 flex items-center gap-1">
            Learn more
            <%= heroicon "arrow-right", variant: :mini, options: { class: "h-3 w-3" } %>
          </div>
        <% end %>
      </li>

      <%# External links %>
      <li>
        <ul role="list" class="-mx-2 space-y-1">
          <li>
            <%= link_to "https://github.com/rameerez/organizations",
              target: "_blank",
              rel: "noopener",
              class: "group flex gap-x-3 rounded-md p-2 text-sm font-semibold leading-6 text-gray-700 hover:text-slate-600 hover:bg-gray-50" do %>
              <%= heroicon "book-open", variant: :outline, options: { class: "h-6 w-6 shrink-0 text-gray-400 group-hover:text-slate-600" } %>
              <span class="flex items-center gap-x-1">
                Documentation
                <%= heroicon "arrow-top-right-on-square", variant: :mini, options: { class: "h-3 w-3 text-gray-400" } %>
              </span>
            <% end %>
          </li>
        </ul>
      </li>
    </ul>
  </nav>
</div>
